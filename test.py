# -*- coding: utf-8 -*-
import time
start_time = time.time()
from score import ScoreDict
from generator import generate_report, get_nb, convert_html_to_pdf
from calc.calc_based_excel import Calculator
from database.unit import dict_school_calc_table
print(time.time() - start_time)

#  TEST CODE
dict_test = {
    "한국사": 1,
    "국어": 130,
    "수학": {
        "수학가형": 130,
    },
    "영어": 2,
    "탐구": {
        "생명과학I": 64,
        "화학II": 67,
    },
    "제2외국어": {
        "아랍어I": 90
    }
}
dict_test = {
    "한국사": 1,
    "국어": 130,
    "수학": {
        "수학나형": 130,
    },
    "영어": 2,
    "탐구": {
        "동아시아사": 67,
        "사회·문화": 60,
    },
    "제2외국어": {
        "아랍어I": 90
    }
}
# dict_result = {'부산사회 문과': '728.775', '강원수의 이과': '527.475', '수원간호 이과': '994.9', '전남농생 이과': '1030.021322', '교원과교 이과': '376.067', '단국이공 이과': '970.75', '서울교 문과': '673.5008438', '건국이공 이과': '648.6975', '가톨간문 문과': '0', '대구교 이과': '464.6625', '부경자전 문과': '0', '가천식영 이과': '987.08', '고려글로 문과': '965.7980456', '외국어 이과': '669.023913', '수원인문 문과': '989.6', '충북수의 이과': '992.0085288', '충남의학 이과': '193.45', '공주교 문과': '373.28125', '경희사회 문과': '0', '경상인문 문과': '713.25', '부산독문 문과': '728.775', '가천이3 이과': '1005.36', '가톨인문 문과': '729.87', '홍익대 이과': '71.98412698', '경희자연 이과': '571.82', '서경대 문과': '954.25', '해양경찰 이과': '589.8', '한양에보 문과': '0', '부산교 문과': '378.5', '경북건축 이과': '735.1333333', '단국의치 이과': '943.6489872', '전북상경 문과': '357.465', '연세대 이과': '694.3666667', '세종대 이과': '966.0954158', '전주교 이과': '571.08', '항공공학 이과': '664.75', '숙명수학 이과': '968.75', '충북자전 문과': '991.2942431', '대구한 문과': '0', '고신대 이과': '651.5', '전북간호 이과': '393.2615', '공주인문 문과': '963', '숙명소프 문과': '0', '부경자전 이과': '760.23', '세종창의 이과': '977.0298507', '울산대 이과': '960.5838416', '경기인문 문과': '101.21', '세명대 문과': '999.225', '공주교육 문과': '770.4', '동의대 이과': '521.62', '고려대 문과': '674.3714286', '고려대 이과': '659.96875', '동덕여 문과': '966.5', '연세대 문과': '726.3', '전북인문 문과': '0', '상명인문 문과': '730', '원광대 문과': '0', '부산중문 문과': '728.775', '충북이공 이과': '991.7100213', '한성대 문과': '1017.75', '영남대 이과': '779.6', '한양가상 문과': '0', '광운이공 이과': '727.775', '서강대 문과': '544.872', '가톨의학 이과': '670.43', '성균관 이과': '759.085', '숙명통계 이과': '969.5', '충북생활 이과': '991.7100213', '인천자연 이과': '1048.3', '교원유교 문과': '364.2775', '서울여패 이과': '392.2', '경북의류 이과': '735.1333333', '삼육대 문과': '975.5', '성신상경 문과': '485', '고려경통 이과': '989.7098104', '제주수의 이과': '955', '성신통계 이과': '506.225', '충북사범 문과': '941.1769723', '서울여수 이과': '405.16', '제주초교 문과': '481.75', '고려생명 이과': '989.7098104', '인하인문 문과': '0', '부경이공 이과': '760.23', '전북중어 문과': '357.465', '시립자연 이과': '963.0446272', '교원컴교 이과': '385.1395', '성신간문 문과': '0', '서울간호 문과': '0', '우석대 문과': '399', '진주교 이과': '390.7', '조선의 이과': '779', '덕성여 문과': '973.25', '광주교 이과': '785.466', '홍익대 문과': '74.52380952', '조선치 이과': '780', '건양대 이과': '966.5', '전북도시 이과': '383.465', '부산일문 문과': '728.775', '가천토목 이과': '972.38', '성신인문 문과': '483.5', '한양에문 문과': '0', '숭실정통 이과': '693.2426887', '서울의류 문과': '0', '경북의학 이과': '735.1333333', '해양해사 이과': '606.7', '인천인문 문과': '1030.6', '가천이2 이과': '1005.36', '동신대 문과': '983', '전남자전 이과': '1011.172708', '전남의학 이과': '967.9317697', '공주자연 이과': '1058.33', '상지대 문과': '971.65', '서울여과 이과': '401.24', '가천의학 문과': '960.25', '강원공학 이과': '527.475', '한양나상 문과': '0', '제주의학 이과': '967', '세종대 문과': '0', '춘천교 이과': '581.7714286', '연원의학 이과': '694.3666667', '부산교 이과': '378.5', '서울과 문과': '0', '성신수학 이과': '496.425', '전북독어 문과': '0', '경북불교 문과': '756.1571429', '동아대 이과': '592', '대구한 이과': '974.6162047', '전남인문 문과': '964.6055437', '고려경통 문과': '983.0428131', '강원간호 문과': '0', '숙명이공 이과': '964.5', '아주인문 문과': '0', '부산불문 문과': '728.775', '광운건축 이과': '757.025', '원광대 이과': '491', '충남농생 이과': '193.45', '중앙대 이과': '756.085', '광운인문 문과': '726.3875', '경북사회 문과': '756.1571429', '한양나 이과': '867.564072', '대전대 이과': '954.65', '교원수교 이과': '364.895', '건국상경 문과': '0', '경북독교 문과': '756.1571429', '서울여문 문과': '392.2', '강원인문 문과': '483', '동신대 이과': '983', '관동대 이과': '875.7', '부경인문 문과': '725.25', '한경인문 문과': '947', '시립융합 이과': '974.6690618', '시립인문 문과': '965.0032206', '고려간호 문과': '0', '단국상경 문과': '0', '인하아태 문과': '0', '계명대 이과': '388.5', '경북인문 문과': '757.5571429', '인하대 이과': '967.5804989', '한양에자 이과': '973.953841', '성신운동 이과': '483.5', '숙명인문 문과': '961.5', '해양공학 이과': '634.08', '수원자연 이과': '1002.4', '고려가교 이과': '667.1214286', '경기자연 이과': '103.13', '동국자연 이과': '662.508', '국민대 문과': '963.5', '상지대 이과': '971.65', '가천의학 이과': '960.25', '서울교 이과': '673.5008438', '명지대 문과': '969', '대구교 문과': '464.6625', '강릉대 이과': '961.5', '이화여 이과': '969.1307527', '경인교 이과': '671.125', '경희인문 문과': '0', '경상의학 이과': '713.25', '전북서어 문과': '0', '서울대 이과': '389.996', '성신간이 이과': '506.225', '충북의학 이과': '942.0085288', '동의대 문과': '0', '외국어 문과': '678.1340917', '전남사회 문과': '964.6055437', '한경자원 이과': '1013.7', '성신글로 문과': '487.8333333', '건국수의 이과': '646.137', '고려가교 문과': '667.1214286', '숙명의류 문과': '0', '교원국교 문과': '363.755', '가천문2 문과': '974', '우석대 이과': '399', '세명대 이과': '999.225', '공주과교 이과': '846.664', '중앙대 문과': '754.51', '청주교 문과': '589.5', '한경컴공 이과': '1038.2', '한양나인 문과': '0', '삼육대 이과': '905', '강원농생 이과': '527.475', '교원가교 이과': '364.895', '숭실이공 이과': '675.4676887', '아주의학 이과': '771.634016', '대전대 문과': '0', '동국한의 이과': '626', '시립상경 문과': '963.7150113', '교원초교 문과': '373.5875', '명지대 이과': '1017.5', '경기법경 문과': '102.98', '단국건축 이과': '1004.25', '인천동북 문과': '1031.3', '고려사국 이과': '529.775', '한성대 이과': '1017.75', '서경대 이과': '988.975', '광주교 문과': '785.466', '아주경영 문과': '0', '인제대 이과': '521', '제주초교 이과': '481.75', '경상이공 이과': '749.125', '공주교 이과': '373.28125', '해양인문 문과': '589.8', '춘천교 문과': '581.7714286', '국민대 이과': '995.9', '상명영양 이과': '749.5', '상명수교 이과': '713.5', '교원초교 이과': '373.5875', '부산한문 문과': '728.775', '단국인문 문과': '0', '동덕여 이과': '997.4', '성균관 문과': '777.58', '전주교 문과': '571.08', '가천인문 문과': '965', '성신의류 이과': '486.625', '순천향 이과': '1002.208845', '충남어문 문과': '195.25', '공주수교 이과': '787.864', '항공경영 문과': '665.5', '항공운항 이과': '675.25', '이화여 문과': '0', '아주자연 이과': '963.0576331', '전북일어 문과': '357.465', '한양가인 문과': '0', '연원사회 문과': '705.0857143', '한림대 이과': '964.2750998', '경인교 문과': '671.125', '수원문화 문과': '964', '진주교 문과': '390.7', '부산노문 문과': '728.775', '서울대 문과': '399.908', '전북불어 문과': '0', '경기유교 문과': '96.1495', '대가대 이과': '526', '과기원 이과': '490.62', '숭실상경 문과': '674.4114644', '광운상경 문과': '726.6325', '건국인문 문과': '0', '충북인문 문과': '991.1769723', '덕성여 이과': '1012.05', '항공소프 이과': '665.5', '교원외교 문과': '366.605', '동국의학 이과': '629.35', '전북의학 이과': '357.465', '교원영교 문과': '363.47', '숭실인문 문과': '671.5010166', '충남사회 문과': '193.45', '부산생과 이과': '741.93', '동국한의 문과': '0', '시립자전 문과': '965.5862047', '충남이공 이과': '193.45', '한양가 이과': '963.96008', '고려화학 이과': '954.8137393', '충북자전 이과': '991.2942431', '서울과 이과': '967.7114971', '관동대 문과': '875.25', '연원인문 문과': '723.12', '부산의학 이과': '728.93', '상명융합 이과': '753.75', '가톨공학 이과': '746.43', '동국인문 문과': '669.771', '광운정보 이과': '770.06375', '숙명물리 이과': '964.5', '전북독교 문과': '357.465', '숙명의류 이과': '961.5', '청주교 이과': '589.5', '경기국제 문과': '102.41', '건국생명 이과': '648.837', '숙명통계 문과': '0', '서강대 이과': '544.872', '연원자연 이과': '698.275', '숙명경상 문과': '963', '충북사범 이과': '941.7100213', '을지대 이과': '950.5'}
dict_result = {'고려대 문과': '653.6571429', '과기원 이과': '0', '수원자연 이과': '955', '경북의류 이과': '697.7888889', '경인교 문과': '650.125', '단국인문 문과': '958.5', '한양나 이과': '0', '청주교 이과': '579', '숙명의류 이과': '0', '성신의류 이과': '476.125', '동국한의 이과': '0', '충남어문 문과': '193.45', '한양나상 문과': '830.0122322', '항공운항 이과': '661.5', '세종대 문과': '919.316395', '충남이공 이과': '0', '광운이공 이과': '0', '대구교 문과': '450.25', '동의대 이과': '0', '한양에보 문과': '942.3786707', '성신간이 이과': '0', '중앙대 이과': '0', '경희사회 문과': '572.448', '우석대 문과': '374.8', '경상의학 이과': '354.5', '동덕여 문과': '939.5', '광주교 문과': '755.2125', '대구한 이과': '0', '강릉대 이과': '0', '가천이2 이과': '962', '항공소프 이과': '661.5', '경상인문 문과': '708.25', '연세대 이과': '0', '한성대 문과': '950.75', '한경자원 이과': '932', '전남농생 이과': '929.5144603', '한림대 이과': '0', '성신인문 문과': '477.5', '공주인문 문과': '951', '가톨의학 이과': '0', '부산의학 이과': '0', '덕성여 문과': '946.25', '고신대 이과': '0', '경북건축 이과': '0', '시립상경 문과': '929.5319', '항공공학 이과': '0', '울산대 이과': '0', '전북독교 문과': '354.195', '가천의학 이과': '0', '경인교 이과': '650.125', '충남의학 이과': '0', '광운인문 문과': '728.95', '숙명소프 문과': '931.5', '진주교 문과': '373.8', '춘천교 이과': '562.2857143', '전남사회 문과': '934.0015169', '아주경영 문과': '917.0932756', '단국상경 문과': '937.5', '상지대 이과': '921.5', '청주교 문과': '579', '고려경통 이과': '917.5416199', '숙명통계 문과': '938', '공주수교 이과': '537.6', '강원공학 이과': '0', '명지대 이과': '939', '해양해사 이과': '586.6', '연원자연 이과': '0', '성신상경 문과': '476', '대전대 이과': '0', '가톨인문 문과': '728.34', '해양공학 이과': '586.6', '해양경찰 이과': '586.6', '단국건축 이과': '940.5', '제주수의 이과': '0', '홍익대 이과': '0', '숙명이공 이과': '0', '부경이공 이과': '720.25', '건국상경 문과': '647.055', '동국자연 이과': '0', '연원사회 문과': '705.0857143', '경기자연 이과': '0', '인천동북 문과': '948.5', '전남인문 문과': '942.6678626', '전남자전 이과': '934.0015169', '한양가 이과': '0', '숙명인문 문과': '952.5', '전북서어 문과': '354.195', '세명대 문과': '919.5', '부산생과 이과': '0', '서울대 문과': '386.508', '관동대 문과': '848.25', '해양인문 문과': '586.6', '동아대 이과': '0', '대구교 이과': '450.25', '동국한의 문과': '622', '인천인문 문과': '950.5', '서울교 문과': '645.080625', '덕성여 이과': '0', '수원문화 문과': '964', '관동대 이과': '0', '세종창의 이과': '919.8691275', '숙명의류 문과': '952.5', '가톨간문 문과': '671.84', '공주과교 이과': '758.4', '부산불문 문과': '723.325', '충북수의 이과': '0', '건국인문 문과': '647.055', '고려글로 문과': '940.9248253', '경북의학 이과': '0', '수원간호 이과': '929.5', '서경대 이과': '939.25', '서울여문 문과': '387.4', '고려가교 이과': '649.6357143', '조선치 이과': '0', '광운정보 이과': '731.9875', '삼육대 문과': '960.5', '가천의학 문과': '927.25', '원광대 이과': '0', '연세대 문과': '711.3', '조선의 이과': '0', '경북사회 문과': '753.0428571', '대가대 이과': '0', '제주초교 이과': '468.25', '숭실상경 문과': '649.7256197', '서울의류 문과': '381.012', '충북자전 문과': '974.9184041', '숭실정통 이과': '650.5924273', '숙명수학 이과': '0', '진주교 이과': '373.8', '부산중문 문과': '723.325', '서경대 문과': '948.25', '가천문2 문과': '962', '공주교육 문과': '760.8', '고려경통 문과': '918.4874606', '경희자연 이과': '0', '영남대 이과': '0', '항공경영 문과': '661.5', '경기법경 문과': '94.7', '연원의학 이과': '0', '성신운동 이과': '477.5', '건국생명 이과': '0', '교원가교 이과': '352.355', '세명대 이과': '919.5', '시립자연 이과': '0', '서울과 문과': '929.9138688', '가천토목 이과': '0', '국민대 문과': '933.5', '서울여패 이과': '387.4', '이화여 문과': '951.8251708', '전주교 이과': '550.92', '성균관 이과': '0', '부경자전 문과': '720.25', '서울여수 이과': '386.2', '건국수의 이과': '0', '한양나인 문과': '840.8907356', '서울대 이과': '0', '부경인문 문과': '720.25', '고려사국 이과': '0', '경기인문 문과': '95', '전북중어 문과': '354.195', '부산교 문과': '366.5', '한양가상 문과': '922.2358135', '상명수교 이과': '0', '아주인문 문과': '927.0636451', '강원농생 이과': '479.25', '인하인문 문과': '941.1628151', '광운건축 이과': '0', '아주자연 이과': '0', '명지대 문과': '939', '전북상경 문과': '354.195', '상명융합 이과': '0', '을지대 이과': '0', '인천자연 이과': '0', '고려화학 이과': '0', '교원초교 문과': '353.4475', '가천인문 문과': '950', '강원수의 이과': '0', '숭실이공 이과': '0', '부산교 이과': '366.5', '부경자전 이과': '0', '충북사범 문과': '935.4792862', '한양에자 이과': '0', '동국의학 이과': '0', '시립인문 문과': '935.7034109', '교원외교 문과': '362.045', '삼육대 이과': '865.5', '전북도시 이과': '0', '충북인문 문과': '985.4792862', '고려가교 문과': '649.6357143', '가톨공학 이과': '720.39', '충남사회 문과': '191.65', '충북이공 이과': '0', '인하대 이과': '0', '이화여 이과': '0', '부산한문 문과': '723.325', '전북독어 문과': '354.195', '동덕여 이과': '938', '광주교 이과': '755.2125', '상명인문 문과': '730', '충북생활 이과': '974.3575221', '전북불어 문과': '354.195', '인하아태 문과': '934.9193309', '한경인문 문과': '935', '전남의학 이과': '0', '숙명통계 이과': '0', '동신대 이과': '943.5', '전북인문 문과': '354.195', '경기유교 문과': '90.25', '교원수교 이과': '0', '춘천교 문과': '562.2857143', '전북일어 문과': '354.195', '고려대 이과': '0', '수원인문 문과': '958', '아주의학 이과': '0', '서강대 이과': '522.756', '가천이3 이과': '962', '한양에문 문과': '947.9874914', '경희인문 문과': '572.448', '건양대 이과': '0', '건국이공 이과': '0', '대전대 문과': '922.85', '단국이공 이과': '0', '대구한 문과': '945.316395', '광운상경 문과': '728.17', '교원초교 이과': '353.4475', '동신대 문과': '943.5', '한양가인 문과': '934.3230395', '성신수학 이과': '0', '중앙대 문과': '756.56', '부산독문 문과': '723.325', '부산노문 문과': '723.325', '외국어 문과': '659.791244', '국민대 이과': '0', '서울과 이과': '0', '상지대 문과': '921.5', '성균관 문과': '758.56', '서울교 이과': '645.080625', '계명대 이과': '0', '경북불교 문과': '753.0428571', '전북의학 이과': '0', '공주자연 이과': '948', '외국어 이과': '0', '순천향 이과': '986.32751', '충북자전 이과': '974.9184041', '동의대 문과': '517.26', '성신통계 이과': '476.125', '경북독교 문과': '753.0428571', '부산일문 문과': '723.325', '충북사범 이과': '0', '경기국제 문과': '97.1', '시립융합 이과': '0', '경상이공 이과': '708.25', '서울간호 문과': '381.012', '한성대 이과': '950.75', '부산사회 문과': '723.325', '서울여과 이과': '386.2', '성신간문 문과': '476', '시립자전 문과': '936.286395', '우석대 이과': '374.8', '연원인문 문과': '723.12', '한경컴공 이과': '932', '세종대 이과': '0', '제주초교 문과': '468.25', '충남농생 이과': '178.4875', '성신글로 문과': '482.8333333', '홍익대 문과': '74.04761905', '공주교 문과': '362.625', '교원과교 이과': '0', '상명영양 이과': '730', '서강대 문과': '522.756', '고려간호 문과': '653.6571429', '숙명경상 문과': '951', '교원국교 문과': '353.495', '강원간호 문과': '480', '교원컴교 이과': '352.355', '단국의치 이과': '0', '강원인문 문과': '480', '공주교 이과': '362.625', '제주의학 이과': '0', '숭실인문 문과': '653.6517942', '전주교 문과': '550.92', '동국인문 문과': '668.853', '고려생명 이과': '0', '교원영교 문과': '353.78', '충북의학 이과': '0', '숙명물리 이과': '0', '인제대 이과': '0', '경북인문 문과': '756.8285714', '원광대 문과': '487', '교원유교 문과': '353.4475', '전북간호 이과': '354.195', '가천식영 이과': '948.5'}

score_dict = ScoreDict(dict_test)


def acc_round(x, n):
    return round(x + 1e-15, n)  # It solve floating point error like round(1.5, 1) = 1


start_time = time.time()
list_already_calc = list()
for school, data in dict_school_calc_table.items():
    for affiliation, list_calc_key in data.items():
        for calc_key in list_calc_key:
            key = calc_key + " " + affiliation
            if key in list_already_calc:
                continue
            calc = Calculator(key, score_dict)
            score = calc.calc()
            correct = acc_round(float(dict_result[key]), 3)
            if abs(score - correct) > 0.01:
                print(key, score, correct)
            #print(key, score, get_nb(key, score))
            list_already_calc.append(key)
print(time.time() - start_time)
